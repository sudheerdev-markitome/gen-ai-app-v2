script: |
# Navigate to your project directory on the server
        cd ~/gen-ai-app

# Pull the latest code
        echo "--- Pulling latest code ---"
        git fetch --all
        git reset --hard origin/main

# Build the frontend static files
        echo "--- Building frontend ---"
        cd gen-ai-frontend
        # Load NVM
        export NVM_DIR="$HOME/.nvm"
        [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
        npm install
        npm run build

        # Deploy frontend files to Nginx root
        echo "--- Deploying frontend files ---"
        sudo rm -rf /var/www/html/* # Clear old files
        sudo cp -R dist/* /var/www/html/
        cd .. # Back to project root

        # Cleanup old Docker resources
        echo "--- Cleaning up Docker resources ---"
        sudo docker system prune -af || true

        # Build and run backend/DB containers
        echo "--- Building and deploying backend/DB containers ---"
        sudo docker compose up --build -d

        # Restart the host Nginx service to apply config changes (if any)
        echo "--- Restarting host Nginx ---"
        sudo systemctl restart nginx